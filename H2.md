# H2

## X)
  Karvinen 2014: Hello Salt Infra-as-Code:
  - Saltin asennus
  - Kansion tekeminen moduulia varten
  - Testitikonfiguraation luominen (moduuli mikä luo tiedoston hello)
  - Idempotentti koska jos tiedosto on jo se ei luo sitä uudestaan

  Salt contributors: Salt overview:
    Yamlin käytännöt niin kuin:
    - Kommentit alkavat #:llä
    - Kaikki on case-sensitive
    - Tab:iä ei saa käyttää, vain välilyöntiä
    Yamlin rakenne, listat, key: Value
    - Identoida yhdellä tai (standardi) kahdella välilyönnillä

  Salt contributors: The top file:
    - Top file on pääkonfigurointi tiedosto mihin määritetään mille koneille tai kone ryhmille mitkä moduulit asennetaan
    - Environments contain targets, targets contain states
    - Environment on ympäristö eli ns "/srv/salt/%ympäristö%" kansio
    - Target eli mihin koneisiin, esim: web palvelimiin tai "-G 'os:Ubuntu'" = koneisiin missä on ubuntu
    - State files eli .sls konfiguraatiotiedostot mitkä istuvat ympäristö kansiossa ja sisältävät sen ympäristön konfiguraation

## A)

  Loin tiedoston init.sls kansioon /srv/salt/infraakoodina

  <img width="289" height="159" alt="image" src="https://github.com/user-attachments/assets/bcfed295-f393-4746-824d-33e03b30a316" />

## B) 

  Loin top.sls tiedoston /srv/salt kansioon

  <img width="261" height="135" alt="image" src="https://github.com/user-attachments/assets/44b1dd8d-3263-49fc-a6d2-411920c92291" />

## C)

  pkg.installed tilafunktio:

  <img width="243" height="138" alt="image" src="https://github.com/user-attachments/assets/d847bfad-73e8-4bfd-ba7c-ff4a560da5b5" />

  user.present tilafunktio:

  <img width="332" height="178" alt="image" src="https://github.com/user-attachments/assets/1f91e5de-eee2-4e00-8507-866a3ab747e3" />

  (file.managed tilafunktio näkyy jo kohdassa A)

  cmd.run tilafunktio:

  <img width="866" height="177" alt="image" src="https://github.com/user-attachments/assets/a6d4dedb-a087-446d-904c-936afc45e908" />

  Päivittää repot jos niitä ei ole tehty 2 päivään: tämä tekee siitä idempotentti

  service.running tilafunktio:
   pistin siihen apache2

## D) 
  
  top.sls missä kaksi tilafunktiota:

  <img width="263" height="144" alt="image" src="https://github.com/user-attachments/assets/f13cb366-7d32-4e3c-8067-dd0ce0f54627" />

  Useamman sudo salt-call --local state.apply jälkeen mikään ei vaihdu koska ei tule (Changed=X) joka osoittaa idempotenssin.

  <img width="693" height="728" alt="image" src="https://github.com/user-attachments/assets/2d8968f0-48ad-4b46-af71-a5378a9c54df" />

  Aikaisemmissa kohdissa koodi oli väärin, minulla oli yksi välilyönti kun piti olla kaksi. Vaihdoin sen.

  ## Lähteet:
    https://terokarvinen.com/palvelinten-hallinta/
    https://terokarvinen.com/2024/hello-salt-infra-as-code/
    https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml
    https://docs.saltproject.io/en/latest/ref/states/top.html

    
  
  
