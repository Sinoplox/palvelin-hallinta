# H4 tehtävä

## X)
Karvinen 2018: Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port

- Ohje tehdä init.sls tiedosto SSH palvelin pakettiin
- Esimerkkitiedosto sshd_config
- Konfiguraation testaaminen (state.apply jälkeen)

## A)

Menin testinä vaihtaa salt-master virtuaalikoneen sshd_config tiedostoa jossa:
Lisäsin "Port 8888", poistin kommenttimerkin kohdasta "Port 22"

Tämän jälkeen ajoin sudo systemctl restart sshd ja testasin connectaa salt-minion virtuaalikoneelta salt-master:iin "ssh -p 8888 saltmaster@%iposoite% joka
osoitti että se toimii mutta ei ole avaimia tehty päästääkseen sisään.

<img width="944" height="117" alt="image" src="https://github.com/user-attachments/assets/5cb105e4-cb91-4977-afea-9bb69420037e" />

Tämä osuus on "testi käsin"

Loin init.sls tiedosto /srv/salt/sshd kansioon

<img width="586" height="487" alt="image" src="https://github.com/user-attachments/assets/648ae97c-25d3-4aa6-a3dc-26322dcd2729" />

Kopioin salt-masterilla config tiedoston sshd kansioon

<img width="1293" height="77" alt="image" src="https://github.com/user-attachments/assets/2bc2bcc1-1997-4316-9179-4a1157315b3f" />

sain tämmöset virheet kun yritin ajaa komento ja tajusin että kopioin tiedoston väärän paikkaan.

<img width="1185" height="803" alt="image" src="https://github.com/user-attachments/assets/802464f3-a7bd-4cbc-b801-3b9458df0679" />

Vaihdoin init.sls polun oikeaksi

<img width="657" height="95" alt="image" src="https://github.com/user-attachments/assets/049631f1-766b-48e5-bb9f-05dac38b37e4" />

tämän jälkeen kaikki onnistui

<img width="653" height="234" alt="image" src="https://github.com/user-attachments/assets/0f502225-2cac-441b-8615-bdff73c37d28" />

jos komennon ajaa uudelleen niin mikään ei vaihdu

<img width="602" height="225" alt="image" src="https://github.com/user-attachments/assets/372624ad-7660-4508-a436-563162adc44a" />

Konfiguraatio toimii mutta avaimia ei ole luotu, kuitenkin saa vastauksen:

<img width="1516" height="275" alt="image" src="https://github.com/user-attachments/assets/6ea10bb8-7c12-4f2f-9d8a-b914b6dfd1dc" />

poistin tiedoston node1 koneella

<img width="1517" height="212" alt="image" src="https://github.com/user-attachments/assets/79fb420a-d982-403b-a908-64d9e832b525" />

ajoin state.apply ja se palautti tiedoston paikoillee

<img width="570" height="719" alt="image" src="https://github.com/user-attachments/assets/7993db2a-c369-483a-9fa9-056d7eea18db" />

## Lähteet

https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh

https://terokarvinen.com/palvelinten-hallinta/



